@using RecipeBook.Enum
@model CreateRecipeViewModel

<div class=" rounded shadow bg-light">
    <p class="fw-bold fs-3 text-center pt-2">Post New Recipe</p>
    <form class="p-4" method="post" asp-controller="Recipe" asp-action="Create" enctype="multipart/form-data">
        <div asp-validation-summary="ModelOnly" class="text-danger validation"></div>
        <div class="mb-4">
            <label asp-for="Name" class="form-label fw-bold fs-5"></label>
            <input asp-for="Name" type="text" class="form-control form-control-lg" placeholder="Recipe Name">
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>

        <div class="mb-4">
            <label asp-for="Description" class="form-label fw-bold fs-5"></label>
            <textarea asp-for="Description" class="form-control" rows="3" placeholder="Food Description...."></textarea>
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>

        <div class="mb-4">
            <label class="form-label fw-bold fs-5 me-5"> Image
                <input asp-for="Image" class="form-control mt-2" type="file" accept="image/*" id="imgInput">
            </label>
            <img id="imgPreview" src="~/images/no-image.jpg" asp-append-version="true" style="width:200px;height:auto;border:1px solid black;" />
            <span asp-validation-for="Image" class="text-danger"></span>
        </div>

        <div class="mb-4">
            <label asp-for="Category" class="form-label fw-bold fs-5"></label>
            <select class="form-select" asp-for="Category" asp-items="Html.GetEnumSelectList<Category>()">
            </select>
            <span asp-validation-for="Category" class="text-danger"></span>
        </div>

        <div class="mb-4">
            <label asp-for="Ingredients" class="form-label fw-bold fs-5"></label>
            <div>
                <div id="ingredient-div" class="border rounded p-2">
                    <div id="ingredient-box" class="border p-2 rounded d-flex flex-wrap gap-4 mb-2 align-items-end">
                        <div>
                            <label class="form-label fw-bold">Quantity</label>
                            <span asp-validation-for="Ingredients[0].Quantity" class="text-danger"></span>
                            <input type="number" class="form-control" asp-for="Ingredients[0].Quantity">
                        </div>
                        <div>
                            <label class="form-label fw-bold">Unit</label>
                            <span asp-validation-for="Ingredients[0].Unit" class="text-danger"></span>
                            <input type="text" class="form-control" asp-for="Ingredients[0].Unit">
                        </div>
                        <div class="flex-grow-1">
                            <label class="form-label fw-bold">Item</label>
                            <span asp-validation-for="Ingredients[0].Item" class="text-danger"></span>
                            <input type="text" class="form-control" asp-for="Ingredients[0].Item">
                        </div>
                    </div>
                </div>
                <div class="mt-3 d-flex flex-wrap justify-content-between">
                    <button id="add-ingredient" class="btn btn-success" style="width:12rem;">Add More Ingredients</button>
                    <button id="remove-ingredient" class="btn btn-danger" style="width:12rem;">Remove Ingredients</button>
                </div>
            </div>
        </div>

        <div class="mb-4">
            <label asp-for="Instructions" class="form-label fw-bold fs-5"></label>
            <div>
                <div id="instruction-div" class="border rounded p-2">
                    <div id="instruction-box" class="border p-2 rounded d-flex flex-wrap gap-4 mb-2 align-items-end">
                        <div class="flex-grow-1">
                            <label class="form-label fw-bold">Direction</label>
                            <span asp-validation-for="Instructions[0].Direction" class="text-danger"></span>
                            <input type="text" class="form-control" asp-for="Instructions[0].Direction">
                        </div>
                    </div>
                </div>
                <div class="mt-3 d-flex flex-wrap justify-content-between">
                    <button id="add-instruction" class="btn btn-success" style="width:12rem;">Add More Instructions</button>
                    <button id="remove-instruction" class="btn btn-danger" style="width:12rem;">Remove Instructions</button>
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary w-100 mt-3 p-2">Save Recipe</button>
    </form>
</div>


@section Scripts {
    <script>
        $("#imgInput").change(function () {
            if (this.files && this.files[0]) {

                var reader = new FileReader();

                reader.onload = function (e) {
                    $('#imgPreview').attr('src', e.target.result);
                }

                reader.readAsDataURL(this.files[0]);
            }
        });



        $("#add-ingredient").click(function (e) {
            e.preventDefault();
            var rowCount = $("#ingredient-div #ingredient-box").length;
            console.log(rowCount);

            var newIngredientBox = $("#ingredient-box").clone();
            newIngredientBox.find("input").val(" ");

            newIngredientBox.find("div:first-child input").attr({
                name: 'Ingredients[' + rowCount + '].Quantity',
                id: 'Ingredients_' + rowCount + '__Quantity',
            })
            newIngredientBox.find("div").eq(1).find("input").attr({
                name: 'Ingredients[' + rowCount + '].Unit',
                id: 'Ingredients_' + rowCount + '__Unit'
            })
            newIngredientBox.find("div:last-child input").attr({
                name: 'Ingredients[' + rowCount + '].Item',
                id: 'Ingredients_' + rowCount + '__Item'
            });

            newIngredientBox.appendTo($("#ingredient-div"));
        });

        $("#remove-ingredient").click(function (e) {
            e.preventDefault();
            if ($("#ingredient-div #ingredient-box").length > 1) {
                $("#ingredient-div #ingredient-box:last-child").remove();
            }
        });



        $("#add-instruction").click(function (e) {
            e.preventDefault();
            var rowCount = $("#instruction-div #instruction-box").length;
            console.log(rowCount);

            var newIngredientBox = $("#instruction-box").clone();
            newIngredientBox.find("input").val(" ");

            newIngredientBox.find("div:first-child input").attr({
                name: 'Instructions[' + rowCount + '].Step',
                id: 'Instructions_' + rowCount + '__Step'
            })
            newIngredientBox.find("div:last-child input").attr({
                name: 'Instructions[' + rowCount + '].Direction',
                id: 'Instructions_' + rowCount + '__Direction'
            })

            newIngredientBox.appendTo($("#instruction-div"));
        });

        $("#remove-instruction").click(function (e) {
            e.preventDefault();
            if ($("#instruction-div #instruction-box").length > 1) {
                $("#instruction-div #instruction-box:last-child").remove();
            }
        });
    </script>
}